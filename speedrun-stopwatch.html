<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedrun Stopwatch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            color: #e4e4e4;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #d4c5a9;
            text-shadow: 0 0 10px rgba(212, 197, 169, 0.3);
        }

        .hotkeys-info {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-bottom: 30px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hotkeys-info kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: #c9b896;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 0 2px;
        }

        .stopwatch-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .run-info {
            margin-bottom: 20px;
        }

        .run-info input, .run-info textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #e4e4e4;
            font-size: 16px;
            font-family: inherit;
        }

        .run-info textarea {
            resize: vertical;
            min-height: 60px;
        }

        .run-info input::placeholder, .run-info textarea::placeholder {
            color: #888;
        }

        .timer-display {
            font-size: 72px;
            font-weight: bold;
            text-align: center;
            font-family: 'Courier New', monospace;
            color: #c9b896;
            margin: 30px 0;
            text-shadow: 0 0 20px rgba(201, 184, 150, 0.4);
            letter-spacing: 4px;
        }

        .timer-display.running {
            color: #a89968;
            text-shadow: 0 0 20px rgba(168, 153, 104, 0.4);
        }

        .timer-display.finished {
            color: #8b7355;
            text-shadow: 0 0 20px rgba(139, 115, 85, 0.4);
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-start {
            background: linear-gradient(135deg, #8b7355, #6b5644);
            color: #fff;
        }

        .btn-stop {
            background: linear-gradient(135deg, #4a4a4a, #2a2a2a);
            color: #fff;
        }

        .btn-lap {
            background: linear-gradient(135deg, #a89968, #8b7f5a);
            color: #fff;
        }

        .btn-reset {
            background: linear-gradient(135deg, #5a5a5a, #3a3a3a);
            color: #fff;
        }

        .btn-export {
            background: linear-gradient(135deg, #c9b896, #a89968);
            color: #1a1a1a;
            padding: 10px 20px;
            font-size: 14px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .splits-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .splits-container h3 {
            margin-bottom: 15px;
            color: #c9b896;
        }

        .split-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            border-left: 3px solid #8b7355;
        }

        .split-item .split-name {
            color: #aaa;
        }

        .split-item .split-times {
            display: flex;
            gap: 20px;
        }

        .split-cumulative {
            color: #a89968;
            font-weight: bold;
        }

        .split-lap {
            color: #8b7355;
        }

        .history-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-section h2 {
            color: #c9b896;
        }

        .pb-badge {
            background: linear-gradient(135deg, #8b7355, #6b5644);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            display: inline-block;
        }

        .history-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #8b7355;
            position: relative;
        }

        .history-item.personal-best {
            border-left-color: #a89968;
            background: rgba(168, 153, 104, 0.1);
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .history-item-title {
            flex: 1;
        }

        .history-item-title h3 {
            color: #c9b896;
            margin-bottom: 5px;
        }

        .history-item-title p {
            color: #888;
            font-size: 14px;
        }

        .history-item-time {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #a89968;
            text-align: right;
        }

        .history-item.personal-best .history-item-time {
            color: #8b7355;
        }

        .history-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-meta-info {
            font-size: 14px;
            color: #888;
        }

        .history-meta-info span {
            margin-right: 15px;
        }

        .btn-delete {
            background: rgba(74, 74, 74, 0.3);
            color: #999;
            padding: 8px 15px;
            font-size: 12px;
            border: 1px solid #555;
        }

        .btn-delete:hover {
            background: rgba(74, 74, 74, 0.5);
            color: #ccc;
        }

        .history-splits {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .history-splits-title {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .history-split-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 13px;
            color: #ccc;
        }

        .no-runs {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 18px;
        }

        .comparison {
            font-size: 14px;
            color: #777;
            margin-left: 10px;
        }

        .comparison.better {
            color: #999;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(168, 153, 104, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(168, 153, 104, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° Speedrun Stopwatch</h1>
        <div class="hotkeys-info">
            <strong>Hotkeys:</strong> 
            <kbd>1</kbd> Start Run ‚Ä¢ 
            <kbd>4</kbd> Add Lap ‚Ä¢ 
            <kbd>9</kbd> Finish Run ‚Ä¢ 
            <kbd>0</kbd> Reset
        </div>
        
        <div class="stopwatch-section">
            <div class="run-info">
                <input type="text" id="runName" placeholder="Run Name (e.g., Any% Route A)" />
                <textarea id="runDescription" placeholder="Description (optional)"></textarea>
            </div>

            <div class="timer-display" id="timerDisplay">00:00.000</div>

            <div class="controls">
                <button class="btn-start" id="startBtn" onclick="startRun()">Start Run</button>
                <button class="btn-lap" id="lapBtn" onclick="addLap()" disabled>Add Lap</button>
                <button class="btn-stop" id="stopBtn" onclick="finishRun()" disabled>Finish Run</button>
                <button class="btn-reset" id="resetBtn" onclick="resetRun()">Reset</button>
            </div>

            <div class="splits-container" id="splitsContainer" style="display: none;">
                <h3>Current Splits</h3>
                <div id="splitsList"></div>
            </div>
        </div>

        <div class="history-section">
            <div class="history-header">
                <h2>Run History</h2>
                <button class="btn-export" onclick="exportRuns()">Export to CSV</button>
            </div>
            <div id="historyList">
                <div class="no-runs">No runs yet. Start your first speedrun!</div>
            </div>
        </div>
    </div>

    <script>
        let startTime = null;
        let elapsedTime = 0;
        let timerInterval = null;
        let isRunning = false;
        let splits = [];
        let lastLapTime = 0;
        let runHistory = [];

        const timerDisplay = document.getElementById('timerDisplay');
        const startBtn = document.getElementById('startBtn');
        const lapBtn = document.getElementById('lapBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const splitsContainer = document.getElementById('splitsContainer');
        const splitsList = document.getElementById('splitsList');
        const historyList = document.getElementById('historyList');

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const milliseconds = ms % 1000;
            
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(3, '0')}`;
        }

        function updateTimerDisplay() {
            const currentTime = Date.now();
            elapsedTime = currentTime - startTime;
            timerDisplay.textContent = formatTime(elapsedTime);
        }

        function startRun() {
            if (isRunning) return;
            
            startTime = Date.now() - elapsedTime;
            isRunning = true;
            timerInterval = setInterval(updateTimerDisplay, 10);
            
            timerDisplay.classList.add('running');
            timerDisplay.classList.remove('finished');
            startBtn.disabled = true;
            lapBtn.disabled = false;
            stopBtn.disabled = false;
            
            splitsContainer.style.display = 'block';
        }

        function addLap() {
            if (!isRunning) return;
            
            const currentTime = elapsedTime;
            const lapTime = currentTime - lastLapTime;
            
            splits.push({
                cumulative: currentTime,
                lap: lapTime,
                name: `Lap ${splits.length + 1}`
            });
            
            lastLapTime = currentTime;
            renderSplits();
        }

        function finishRun() {
            if (!isRunning) return;
            
            clearInterval(timerInterval);
            isRunning = false;
            
            const finalTime = elapsedTime;
            const runName = document.getElementById('runName').value.trim() || 'Unnamed Run';
            const runDescription = document.getElementById('runDescription').value.trim();
            
            // Add final split if there are laps
            if (splits.length > 0) {
                const lapTime = finalTime - lastLapTime;
                splits.push({
                    cumulative: finalTime,
                    lap: lapTime,
                    name: `Lap ${splits.length + 1}`
                });
            }
            
            const run = {
                id: Date.now(),
                name: runName,
                description: runDescription,
                time: finalTime,
                splits: [...splits],
                date: new Date().toISOString(),
                lapCount: splits.length
            };
            
            runHistory.unshift(run);
            renderHistory();
            saveToStorage();
            
            timerDisplay.classList.remove('running');
            timerDisplay.classList.add('finished');
            startBtn.disabled = true;
            lapBtn.disabled = true;
            stopBtn.disabled = true;
        }

        function resetRun() {
            clearInterval(timerInterval);
            isRunning = false;
            startTime = null;
            elapsedTime = 0;
            splits = [];
            lastLapTime = 0;
            
            timerDisplay.textContent = '00:00.000';
            timerDisplay.classList.remove('running', 'finished');
            startBtn.disabled = false;
            lapBtn.disabled = true;
            stopBtn.disabled = true;
            
            splitsList.innerHTML = '';
            splitsContainer.style.display = 'none';
        }

        function renderSplits() {
            splitsList.innerHTML = splits.map(split => `
                <div class="split-item">
                    <span class="split-name">${split.name}</span>
                    <div class="split-times">
                        <span class="split-cumulative">${formatTime(split.cumulative)}</span>
                        <span class="split-lap">(+${formatTime(split.lap)})</span>
                    </div>
                </div>
            `).join('');
        }

        function renderHistory() {
            if (runHistory.length === 0) {
                historyList.innerHTML = '<div class="no-runs">No runs yet. Start your first speedrun!</div>';
                return;
            }
            
            const personalBest = Math.min(...runHistory.map(run => run.time));
            
            historyList.innerHTML = runHistory.map(run => {
                const isPB = run.time === personalBest;
                const comparison = personalBest < run.time ? 
                    `<span class="comparison">+${formatTime(run.time - personalBest)}</span>` : '';
                
                const splitsHtml = run.splits.length > 0 ? `
                    <div class="history-splits">
                        <div class="history-splits-title">Splits (${run.lapCount})</div>
                        ${run.splits.map(split => `
                            <div class="history-split-item">
                                <span>${split.name}</span>
                                <span>${formatTime(split.cumulative)} (+${formatTime(split.lap)})</span>
                            </div>
                        `).join('')}
                    </div>
                ` : '';
                
                return `
                    <div class="history-item ${isPB ? 'personal-best' : ''}">
                        <div class="history-item-header">
                            <div class="history-item-title">
                                <h3>
                                    ${run.name}
                                    ${isPB ? '<span class="pb-badge">‚≠ê PB</span>' : ''}
                                </h3>
                                ${run.description ? `<p>${run.description}</p>` : ''}
                            </div>
                            <div class="history-item-time">
                                ${formatTime(run.time)}
                                ${comparison}
                            </div>
                        </div>
                        ${splitsHtml}
                        <div class="history-meta">
                            <div class="history-meta-info">
                                <span>üìÖ ${new Date(run.date).toLocaleString()}</span>
                                ${run.lapCount > 0 ? `<span>üèÅ ${run.lapCount} laps</span>` : ''}
                            </div>
                            <button class="btn-delete" onclick="deleteRun(${run.id})">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteRun(id) {
            if (confirm('Are you sure you want to delete this run?')) {
                runHistory = runHistory.filter(run => run.id !== id);
                renderHistory();
                saveToStorage();
            }
        }

        function exportRuns() {
            if (runHistory.length === 0) {
                alert('No runs to export!');
                return;
            }
            
            let csv = 'Run Name,Description,Time (ms),Time (formatted),Date,Lap Count,Splits\n';
            
            runHistory.forEach(run => {
                const splitsData = run.splits.map(s => 
                    `${s.name}:${formatTime(s.cumulative)}(+${formatTime(s.lap)})`
                ).join('; ');
                
                csv += `"${run.name}","${run.description}",${run.time},"${formatTime(run.time)}","${new Date(run.date).toLocaleString()}",${run.lapCount},"${splitsData}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `speedrun-history-${Date.now()}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Save to localStorage
        function saveToStorage() {
            localStorage.setItem('speedrunHistory', JSON.stringify(runHistory));
        }

        // Load from localStorage
        function loadFromStorage() {
            const saved = localStorage.getItem('speedrunHistory');
            if (saved) {
                runHistory = JSON.parse(saved);
                renderHistory();
            }
        }

        // Initialize
        loadFromStorage();

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Prevent shortcuts when typing in input fields
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                return;
            }

            switch(event.key) {
                case '1':
                    // Start run
                    if (!startBtn.disabled) {
                        startRun();
                    }
                    break;
                case '4':
                    // Add lap
                    if (!lapBtn.disabled) {
                        addLap();
                    }
                    break;
                case '9':
                    // Finish run
                    if (!stopBtn.disabled) {
                        finishRun();
                    }
                    break;
                case '0':
                    // Reset
                    if (!resetBtn.disabled) {
                        resetRun();
                    }
                    break;
            }
        });
    </script>
</body>
</html>
